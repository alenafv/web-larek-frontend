# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных 

Карточка

```
export interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Покупатель

```
export interface ICustomer {
    email: string;
    address: string;
    phone: string;
    paymentMethod: string;
}
```

Интерфейс для модели данных товаров

```
export interface ICardData {
    card: ICard[];
    preview: string | null;
}
```

Полные данные продукта

```
export type TCardInfo = Pick<ICard, 'image' | 'category' | 'title' | 'description' | 'price'>;
```

Данные продукта в корзине

```
export type TBasket = Pick<ICard, 'title' | 'price'>;
```

Данные в форме выбора способа оплаты и адреса

```
export type TPaymentMethodAndAddress = Pick<ICustomer, 'paymentMethod' | 'address'>;
```

Данные в форме ввода email и телефона

```
export type TEmailAndPhone = Pick<ICustomer, 'email' | 'phone'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранений и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Арі
Содержит в себе базовую логику отправки запросов.
В конструктор передается базовый адрес
сервера и опциональный объект с заголовками запросов. \
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с
объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса,
отправляет эти данные на ендпоинт переданный как параметр при вызове метода.
- `handleResponse` - обрабатывает ответ от сервера. Если ответ успешен, возвращает промис с данными ответа. В противном случае, возвращает промис с ошибкой, содержащей информацию об ошибке или статус текст

#### Класс EventEmitter
Обеспечивает работу событий. Его функции: возможность установить и снять слушателей событий, вызвать слушателей при возникновении события. Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on`, `off`, `emit` - для установки обработчика на событие, снятия его и инициирования события с данными
- `onAll` и `offAll` - для подписки на все события и сброса всех подписчиков.
- `trigger` - генерирует заданное событие при вызове

### Слой данных
#### Класс CardList (каталог товаров)
Класс представляет каталог товаров \
Свойства:
- cards: Card[] - список товаров
- preview: string | null - id карточки, выбранной для просмотра в модальном окне

Методы:
- `getCardList()` - возвращает список товаров
- `getCard(cardId: string): ICard` - возвращает карточку по ее id

#### Класс BasketModel (корзина с товарами)
Класс представляет корзину с товарами \
Свойства:
- items: Card[] - список товаров в корзине.

Методы:
- `getItems()` - возвращение списка товаров 
- `hasItem(id: string)` - проверка наличия определенного товара в корзине
- `addItem(card: Card)` - добавление (увеличение количества) товара 
- `removeItem(id: string)` - удаление (уменьшение количества) товара 
- `clearBasket()` - очистка корзины.

#### Класс Customer (данные покупателя)
Класс представляет данные о покупателе \
Свойства:
- email: string - email покупателя,
- address: string - адрес покупателя,
- phone: string - телефон покупателя,
- paymentMethod: string - способ оплаты

Методы:
- `setCustomerInfo(customer: ICustomer): void` - сохраняет данные пользователя в классе
- `checkValidation(): boolean` - проверяет объект с данными пользователя на валидность
- `getCustomerData()` - возвращает данные 

### Компоненты представления
#### Класс Card (карточка товара)
Класс отвечает за отображение карточки, задавая в карточке нужные данные. В конструктор класса передается DOM элемент темплейта, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки:
- template: HTMLElement - DOM элемент темплейта карточки
- eventEmitter: EventEmitter - экземпляр EventEmitter для инициации событий
- cardElement: HTMLElement - основной элемент карточки
- titleElement: HTMLElement - элемент для отображения названия товара
- categoryElement: HTMLElement - элемент для отображения категории
- descriptionElement: HTMLElement - элемент для отображения описания товара
- priceElement: HTMLElement - элемент для отображения цены товара
- imageElement: HTMLImageElement - элемент для отображения изображения товара
- buttonElement: HTMLButtonElement - элемент для кнопки действия - добавления в корзину

Методы:
- `render(card: Card)` - рендерит карточку товара
- `setCategory(category: string)` - устанавливает категорию товара
- `setTitle(title: string)` - устанавливает название товара
- `setDescription(description: string)` - устанавливает описание товара
- `setPrice(price: number)` - устанавливает цену товара
- `setImage(imageUrl: string)` - устанавливает изображение товара
- `setButtonText(text: string)` - устанавливает текст кнопки
- геттер id возвращает уникальный id карточки

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `ореn` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и на кнопку-крестик для закрытия попапа.
- constructor(selector: string, events: lEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий. 

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий
- content: HTMLElement | null - элемент для вставки контента модального окна

Методы:
- `open()` - открывает модальное окно
- `close()` - закрывает модальное окно
- `setContent(content: HTMLElement)` - устанавливает контент модального окна
- `setEventListeners()` - устанавливает слушатели на клик в оверлей и на кнопку-крестик для закрытия попапа

#### Класс CardFull
Предназначен для реализации модального окна с полной информацией о выбранной карточке товара. Использует класс `Card` для рендеринга карточки товара. 
- constructor(selector: string, events: lEvents) Конструктор предназначен для инициализации объекта, который будет реализовывать модальное окно с полной информацией о выбранной карточке товара. В конструктор передаются два параметра: селектор шаблона модального окна и экземпляр класса EventEmitter для инициации событий.

Поля класса:

- template: HTMLTemplateElement - шаблон модального окна
- card: Card - экземпляр класса Card для рендеринга карточки товара

Методы:
- `render(card: CardData): HTMLElement` - рендерит модальное окно с полной информацией о товаре

#### Класс OrderForm
Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.
- constructor(selector: string, events: lEvents) Конструктор класса OrderForm предназначен для инициализации объекта, который будет реализовывать модальное окно с формой заказа. В конструктор передаются два параметра: селектор шаблона модального окна и экземпляр класса EventEmitter для инициации событий.

Поля класса:
- template: HTMLTemplateElement - шаблон модального окна.
- submitButton: HTMLButtonElement - Кнопка подтверждения
- form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errorElement: HTMLElement - Элемент для вывода текста ошибок на форме

Методы:
- `render(): HTMLElement` - рендерит форму заказа.
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>`- возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок в элементе для вывода ошибок
- `showInputError (errorMessage: string): void` - отображает полученный текст ошибки в элементе для вывода ошибок
- `hideInputError (): void` - очищает текст ошибки в элементе для вывода ошибок
- `close (): void` - при закрытии очищает поля формы и деактивирует кнопку сохранения

### Слой коммуникации
#### Класс АррАрі
Принимает в конструктор экземпляр класса Арі и предоставляет методы реализующие
взаимодействие с бэкендом сервиса.
## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index. ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`
B `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий. \
Список всех событий, которые могут генерироваться в системе: \
События изменения данных (генерируются классами моделями данных)
- `customer: changed` - изменение данных пользователя

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление):
- `card:select` - выбор карточки товара для отображения в модальном окне
- `cardFull:open` - открытие модального окна с полной информацией о товаре
- `basketModel:changed` - изменение списка в корзине
- `basketModel:open` - открытие корзины
- `orderForm:open` - открытие модального окна с инпутами
- `orderForm:input` - ввод данных в инпуты
- `orderForm:submit` - событие, генерируемое при нажатии кнопки в форме
- `orderForm:validation` - валидация в форме
